<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caro Game</title> 
</head>
<link rel="stylesheet" href="caro_style.css">
<body>
    <div class="game-area">
        <div class = "dispplay_status">
            <fieldset class = "form-group1">
                <legend><b>ðŸŽ® Caro Game</b></legend>
                <!-- <p> Columns: 
                <input id="columnInput" name="keyword" type="number" placeholder="Enter column" value="20">
                 Rows: 
                <input id="rowInput" name="keyword" type="number" placeholder="Enter row" value="20"> -->
                <p class="selectSize">Select size:
                    <select id="select_option">
                        <option value="10">10x10 â–“</option>
                        <option value="15">15x15 â–“</option>
                        <option value="20" selected>20x20 â–“</option>
                    </select>
                </p>
                <p><button type="button" class="start" onclick="startGame()">ðŸ†• Start/Reset Game</button></p>
                <p><button type="button" class="score" onclick="removeScore()">ðŸ”¢ Remove Score</button></p>
            </fieldset>

            <div class = "form-group2">
                <div style="color: #eab4dd; font-size: 25px;"><b>Player turn</b></div>
                <div id="playerTurnInfo">X</div>
            </div>
            <div class="score-board">
                <h3 style="color: #eab4dd; margin-bottom: 15px; text-align: center;">SCORE</h3>
                <div class="score-x">
                    <div>
                        <div style="color: #00dbde; font-size: 14px;">Player X</div>
                        <div class="score-value" id="scoreX">0</div>
                    </div>
                        <div style="color: #00dbde; font-size: 42px;">âœ–</div>
                </div>
                        
                <div class="score-o">
                    <div>
                        <div style="color: #f5576c; font-size: 14px;">Player O</div>
                        <div class="score-value" id="scoreO">0</div>
                    </div>
                    <div style="color: #f5576c; font-size: 32px;">â­•</div>
                </div>
            </div>
        </div>
        <div class = "form-group3">
            <p id="status" style ="text-align: center; font-size: 25px; color: #eab4dd;">Click to empty cell to play!</p>
            <div id="board"></div>                
            <!-- <p id="result" style ="text-align: center;"></p> -->
        </div>
    </div>

<script>
class GameBoard {
    constructor(width, height) {
        this.width = width;
        this.height = height;
        this.board = [];
        this.currentPlayer = "X";
        this.createBoard();
        this.gameOver = false;
        this.winCells = [];
    }

    createBoard() {
        for (let i = 0; i < this.width; i++) {
            this.board[i] = [];
            for (let j = 0; j < this.height; j++) {
                this.board[i][j] = "";
            }
        }
        this.displayBoard();
    }

    displayBoard() {
        let table = '<table border="1">';
        for (let i = 0; i < this.width; i++) {
            table += "<tr>";
            for (let j = 0; j < this.height; j++) {

                let color = "";
                if (this.board[i][j] === "X") color = "#3498db";
                if (this.board[i][j] === "O") color = "#e74c3c";

                table += `
                    <td onclick="game.handleClick(${i}, ${j})"
                        style="width:25px;height:25px;
                               cursor:pointer;
                               font-weight:bold;
                               border:1px solid ${color};
                               color:${color}">
                        ${this.board[i][j]}
                    </td>`;
            }
            table += "</tr>";
        }
        table += "</table>";
        document.getElementById("board").innerHTML = table;
    }

    handleClick(i, j) {
        if (this.gameOver) return;
        if (this.board[i][j] !== "") return;

        this.board[i][j] = this.currentPlayer;
        if (this.checkWin(i, j)) {
            this.displayBoard();
            this.winCells.forEach(cell => {
                let cellElement = document.querySelector(`#board table tr:nth-child(${cell[0] + 1}) td:nth-child(${cell[1] + 1})`);
                cellElement.style.backgroundColor = "rgba(255, 255, 0, 0.463)";
            });
            // document.getElementById("result").innerText = this.currentPlayer + " win! ðŸŽ‰";
            this.gameOver = true;
            document.getElementById("status").innerHTML = '<button class="win" onclick="startGame()">Congratulations ' + this.currentPlayer + ' win! ðŸŽ‰. Start new game!</button>';
            if (this.currentPlayer === "X") {
                let scoreX = parseInt(document.getElementById("scoreX").innerText);
                document.getElementById("scoreX").innerText = scoreX + 1;
            } else {
                let scoreO = parseInt(document.getElementById("scoreO").innerText);
                document.getElementById("scoreO").innerText = scoreO + 1;
            }
            return;
        }
        this.switchPlayer();
    }

    switchPlayer() {
        if (this.currentPlayer === "X") {
            this.currentPlayer = "O";
            document.getElementById("playerTurnInfo").style.color = "#f5576c";
            document.getElementById("playerTurnInfo").style.textShadow = "0 0 10px #f5576c, 0 0 20px #f5576c, 0 0 30px #f5576c";
        } else {
            this.currentPlayer = "X";
            document.getElementById("playerTurnInfo").style.color = "#00dbde";
            document.getElementById("playerTurnInfo").style.textShadow = "0 0 10px #00dbde, 0 0 20px #00dbde, 0 0 30px #00dbde";
        }
        document.getElementById('playerTurnInfo').textContent = this.currentPlayer;
        this.displayBoard();
    }

    checkWin(i, j) {
        let mark = 0;
        this.winCells = [[i, j]];

        // hÃ ng ngang
        // kiá»ƒm tra sang trÃ¡i
        mark = i - 1;
        while (mark >= 0 && this.board[mark][j] === this.currentPlayer) {
            this.winCells.push([mark, j]);
            mark--;
        }

        // kiá»ƒm tra sang pháº£i
        mark = i + 1;
        while (mark < this.width && this.board[mark][j] === this.currentPlayer) {
            this.winCells.push([mark, j]);
            mark++;
        }

        // náº¿u Ä‘á»§ 5 Ã´ liÃªn tiáº¿p
        if (this.winCells.length >= 5) {return true;}return false;

        //hÃ ng dá»c
        this.winCells = [[i, j]];
        // kiá»ƒm tra lÃªn trÃªn
        mark = j - 1;
        while (mark >= 0 && this.board[i][mark] === this.currentPlayer) {
            this.winCells.push([i, mark]);
            mark--;
        }

        // kiá»ƒm tra xuá»‘ng dÆ°á»›i
        mark = j + 1;
        while (mark < this.height && this.board[i][mark] === this.currentPlayer) {
            this.winCells.push([i, mark]);
            mark++;
        }

        if (this.winCells.length >= 5) {return true;}return false;

        //chÃ©o \
        this.winCells = [[i, j]];
        // kiá»ƒm tra lÃªn trÃªn bÃªn trÃ¡i
        mark = 1;
        while (i - mark >= 0 && j - mark >= 0 && this.board[i - mark][j - mark] === this.currentPlayer) {
            this.winCells.push([i - mark, j - mark]);
            mark++;
        }
        // kiá»ƒm tra xuá»‘ng dÆ°á»›i bÃªn pháº£i
        mark = 1;
        while (i + mark < this.width && j + mark < this.height && this.board[i + mark][j + mark] === this.currentPlayer) {
            this.winCells.push([i + mark, j + mark]);
            mark++;
        }
        if (this.winCells.length >= 5) {return true;}return false;
        //chÃ©o /
        this.winCells = [[i, j]];
        // kiá»ƒm tra lÃªn trÃªn bÃªn pháº£i
        mark = 1;
        while (i + mark < this.width && j - mark >= 0 && this.board[i + mark][j - mark] === this.currentPlayer) {
            this.winCells.push([i + mark, j - mark]);
            mark++;
        }
        // kiá»ƒm tra xuá»‘ng dÆ°á»›i bÃªn trÃ¡i
        mark = 1;
        while (i - mark >= 0 && j + mark < this.height && this.board[i - mark][j + mark] === this.currentPlayer) {
            this.winCells.push([i - mark, j + mark]);
            mark++;
        }
        if (this.winCells.length >= 5) {return true;}return false;

    }

}

function startGame() {
    // let columns = parseInt(document.getElementById("columnInput").value);
    // let rows = parseInt(document.getElementById("rowInput").value);
    document.getElementById("status").innerText = 'Click to empty cell to play!';
    document.getElementById("playerTurnInfo").innerHTML = `<div style="color: #00dbde; text-shadow: 0 0 10px #00dbde, 0 0 20px #00dbde, 0 0 30px #00dbde;">X</div>`;
    let size = document.getElementById("select_option").value;
    game = new GameBoard(size, size);
}

function removeScore() {
    document.getElementById("scoreX").innerText = "0";
    document.getElementById("scoreO").innerText = "0";
}

startGame();
</script>
</body>
</html>